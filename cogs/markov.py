import random
from collections import OrderedDict

from discord.ext import commands

from bot import Bot

# data from https://github.com/Udzu/pudzu/blob/master/dataviz/markovtext_wikienglish.csv
epsilon = OrderedDict(
    {' ': 16.3, 'a': 7.2, 'b': 1.3, 'c': 2.9, 'd': 3.2, 'e': 10.1, 'f': 1.9, 'g': 1.6, 'h': 4.0, 'i': 6.3,
     'j': 0.2, 'l': 0.5, 'm': 3.6, 'n': 2.2, 'o': 6.2, 'p': 6.1, 'q': 1.8, 'r': 0.1, 's': 5.5, 't': 5.6,
     'u': 7.2, 'v': 2.2, 'w': 0.9, 'x': 1.4, 'y': 0.2, 'z': 1.3})

probabilities = {
    ' ': (
    2.7, 12.0, 4.5, 5.6, 3.0, 2.6, 4.2, 1.7, 3.7, 6.4, 0.7, 0.6, 2.5, 3.8, 2.2, 7.1, 4.3, 0.2, 3.2, 6.7, 14.2, 1.4, 0.9,
    5.3, 0.1, 0.4, 0.1),
    'a': (
    8.1, 0.1, 1.7, 3.9, 3.5, 0.3, 0.9, 2.2, 0.3, 3.1, 0.2, 0.9, 10.8, 3.8, 19.1, 0.1, 1.7, 0.1, 11.4, 9.4, 12.5, 1.3,
    1.6, 0.6, 0.2, 1.9, 0.2),
    'b': (
    1.7, 11.4, 1.0, 0.6, 0.2, 26.7, 0.1, 0.0, 0.1, 6.1, 0.6, 0.0, 9.8, 0.3, 0.2, 10.7, 0.1, 0.0, 7.4, 2.8, 0.4, 9.4,
    0.1, 0.1, 0.0, 10.3, 0.0),
    'c': (
    4.4, 13.8, 0.1, 1.9, 0.1, 14.0, 0.0, 0.0, 14.5, 6.7, 0.0, 3.4, 4.1, 0.1, 0.1, 18.5, 0.1, 0.1, 3.8, 0.9, 9.1, 3.2,
    0.0, 0.0, 0.0, 0.9, 0.1),
    'd': (
    51.1, 4.3, 0.2, 0.3, 1.0, 16.4, 0.2, 0.6, 0.3, 10.1, 0.1, 0.0, 0.6, 0.4, 0.2, 3.5, 0.1, 0.0, 1.9, 2.9, 0.6, 3.5,
    0.4, 0.4, 0.0, 0.8, 0.0),
    'e': (
    30.5, 4.7, 0.4, 3.0, 8.7, 2.1, 0.9, 1.0, 0.3, 1.2, 0.0, 0.2, 3.6, 2.3, 8.7, 0.6, 1.1, 0.3, 14.1, 8.5, 2.9, 0.3, 1.6,
    0.9, 1.1, 0.8, 0.1),
    'f': (
    36.8, 5.5, 0.1, 0.2, 0.1, 7.5, 4.3, 0.1, 0.0, 10.5, 0.0, 0.0, 2.5, 0.1, 0.0, 17.1, 0.0, 0.0, 8.0, 0.3, 3.9, 2.7,
    0.0, 0.0, 0.0, 0.2, 0.0),
    'g': (
    29.3, 8.0, 0.2, 0.1, 0.5, 17.3, 0.1, 0.9, 8.6, 6.7, 0.0, 0.0, 2.8, 0.4, 3.0, 4.8, 0.1, 0.0, 7.9, 2.3, 1.0, 4.5, 0.0,
    0.2, 0.0, 1.2, 0.0),
    'h': (
    12.1, 12.1, 0.1, 0.1, 0.1, 48.0, 0.1, 0.0, 0.0, 11.9, 0.0, 0.0, 0.3, 0.3, 0.6, 8.0, 0.1, 0.0, 1.5, 0.4, 1.8, 1.4,
    0.0, 0.2, 0.0, 0.7, 0.0),
    'i': (
    1.2, 4.0, 0.9, 7.8, 2.8, 4.1, 1.5, 2.7, 0.0, 0.3, 0.0, 0.5, 5.1, 2.9, 26.3, 7.8, 1.1, 0.1, 3.5, 11.7, 11.2, 0.3,
    3.1, 0.0, 0.3, 0.0, 0.7),
    'j': (
    2.3, 21.0, 0.1, 0.1, 0.2, 19.8, 0.1, 0.0, 0.1, 3.7, 0.1, 0.2, 0.1, 0.1, 0.2, 28.5, 0.3, 0.0, 0.8, 0.3, 0.1, 21.7,
    0.1, 0.0, 0.0, 0.1, 0.0),
    'k': (
    25.8, 5.8, 0.3, 0.2, 0.2, 24.9, 0.3, 0.3, 1.4, 14.8, 0.1, 0.3, 2.1, 1.0, 5.6, 3.1, 0.3, 0.0, 1.1, 7.6, 1.1, 1.4,
    0.1, 0.5, 0.0, 1.5, 0.0),
    'l': (
    15.1, 12.4, 0.6, 0.3, 4.3, 16.0, 0.8, 0.2, 0.1, 12.5, 0.0, 0.4, 10.9, 0.9, 0.1, 7.5, 0.4, 0.0, 0.2, 3.5, 2.6, 2.7,
    0.6, 0.2, 0.0, 7.5, 0.0),
    'm': (
    12.7, 19.4, 3.9, 0.3, 0.2, 23.3, 0.1, 0.1, 0.1, 10.5, 0.0, 0.0, 0.2, 3.3, 0.3, 10.6, 6.9, 0.0, 0.2, 2.7, 0.4, 3.5,
    0.0, 0.1, 0.0, 1.1, 0.0),
    'n': (
    26.1, 5.0, 0.3, 4.3, 14.0, 7.6, 0.7, 10.4, 0.3, 4.7, 0.1, 0.5, 0.7, 0.4, 1.2, 4.1, 0.1, 0.0, 0.2, 5.6, 10.7, 1.1,
    0.5, 0.1, 0.0, 1.0, 0.1),
    'o': (
    10.2, 0.8, 0.9, 2.0, 2.0, 0.4, 11.4, 1.2, 0.4, 0.9, 0.1, 0.7, 4.6, 6.0, 18.6, 2.1, 2.7, 0.0, 14.2, 3.1, 3.9, 7.4,
    2.2, 3.5, 0.3, 0.4, 0.1),
    'p': (
    5.7, 13.1, 0.1, 0.2, 0.1, 16.4, 0.1, 0.1, 3.9, 5.6, 0.0, 0.2, 9.2, 0.7, 0.1, 13.3, 4.7, 0.0, 15.4, 2.2, 3.6, 4.7,
    0.0, 0.1, 0.0, 0.4, 0.0),
    'q': (
    2.8, 1.1, 0.1, 0.1, 0.0, 0.1, 0.1, 0.0, 0.1, 1.6, 0.0, 0.0, 0.2, 0.1, 0.1, 0.1, 0.1, 0.1, 0.2, 0.3, 0.3, 92.5, 0.1,
    0.0, 0.0, 0.0, 0.0),
    'r': (
    17.1, 9.3, 0.5, 1.7, 2.6, 20.5, 0.5, 1.5, 0.2, 10.2, 0.0, 1.4, 1.5, 2.3, 2.4, 9.6, 0.6, 0.0, 1.7, 5.6, 5.1, 1.7,
    0.9, 0.2, 0.0, 3.0, 0.0),
    's': (
    39.2, 2.6, 0.3, 2.1, 0.2, 10.3, 0.3, 0.1, 4.1, 7.3, 0.0, 0.5, 0.9, 0.9, 0.2, 5.1, 2.4, 0.1, 0.2, 4.2, 14.4, 3.3,
    0.1, 0.4, 0.0, 0.7, 0.0),
    't': (
    16.0, 5.2, 0.1, 0.3, 0.1, 12.1, 0.1, 0.0, 29.7, 11.1, 0.0, 0.0, 1.1, 0.2, 0.1, 9.1, 0.1, 0.0, 4.1, 3.2, 1.7, 2.2,
    0.1, 0.9, 0.0, 2.2, 0.1),
    'u': (
    1.2, 4.5, 2.9, 5.2, 3.3, 4.5, 0.5, 3.8, 0.1, 3.1, 0.1, 0.5, 8.1, 4.7, 14.3, 0.3, 3.7, 0.0, 14.2, 14.5, 9.9, 0.0,
    0.1, 0.0, 0.2, 0.1, 0.1),
    'v': (
    1.7, 11.0, 0.0, 0.1, 0.2, 56.6, 0.0, 0.0, 0.0, 23.1, 0.0, 0.0, 0.1, 0.0, 0.1, 5.5, 0.0, 0.0, 0.2, 0.3, 0.1, 0.2,
    0.0, 0.0, 0.0, 0.7, 0.0),
    'w': (
    8.4, 23.1, 0.1, 0.1, 0.2, 16.2, 0.1, 0.0, 13.9, 17.4, 0.0, 0.1, 0.6, 0.1, 5.2, 9.8, 0.1, 0.0, 1.7, 2.0, 0.4, 0.1,
    0.0, 0.1, 0.0, 0.2, 0.0),
    'x': (
    17.4, 10.5, 0.4, 6.4, 0.1, 7.1, 1.2, 0.1, 1.5, 14.6, 0.1, 0.0, 0.4, 0.6, 0.1, 1.8, 16.9, 0.0, 0.3, 0.6, 15.8, 1.8,
    0.3, 0.2, 0.5, 1.2, 0.0),
    'y': (
    69.8, 2.2, 0.5, 0.9, 0.7, 5.4, 0.3, 0.2, 0.4, 1.9, 0.1, 0.1, 1.5, 1.3, 1.2, 3.1, 1.6, 0.0, 0.7, 5.2, 1.9, 0.4, 0.1,
    0.4, 0.0, 0.0, 0.1),
    'z': (
    9.7, 18.3, 0.5, 0.3, 0.3, 35.1, 0.2, 0.3, 1.9, 13.5, 0.0, 0.4, 1.0, 0.5, 0.5, 7.4, 0.2, 0.1, 0.3, 0.7, 0.7, 2.4,
    0.2, 0.3, 0.1, 1.6, 3.4)
}


class Markov:
    def __init__(self, bot: Bot):
        self.bot = bot

    @commands.group()
    async def markov(self):
        pass

    @markov.command()
    async def word(self):
        word = random.choices(tuple(epsilon.keys())[1:], tuple(epsilon.values())[1:])[0]

        while True:
            char = random.choices(tuple(probabilities.keys()), probabilities[word[-1]])[0]
            if char != ' ':
                word += char
            else:
                await self.bot.say(word)
                return


def setup(bot):
    bot.add_cog(Markov(bot))
